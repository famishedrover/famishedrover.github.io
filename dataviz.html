<!DOCTYPE html>
<html>
<head>
	<title>SEINet Visualization</title>
	<!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Favicon -->
    <link rel="apple-touch-icon" sizes="180x180" href="dataviz/img/favicon/apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="dataviz/img/favicon/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="dataviz/img/favicon/favicon-16x16.png">
	<link rel="manifest" href="dataviz/img/favicon/site.webmanifest">

    <!-- D3.js script -->
	<script src="https://d3js.org/d3.v5.min.js"></script>

	<!-- Scripts for Bootstrap -->
	<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

	<!-- Bootstrap CSS -->
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
	
	<!-- Stylesheet with accordion image effects -->
	<link rel="stylesheet" href="dataviz/css/style.css">

	<!-- Map-related Files -->
	<link rel="stylesheet" href="dataviz/plant_map/map_css.css"/>
	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css"
		  integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
		  crossorigin=""/>
	<!-- Make sure you put this AFTER Leaflet's CSS -->
	<script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"
			integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew=="
			crossorigin=""></script>
	<script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js"
			crossorigin=""></script>

	<!-- Map-related Customized scripts -->
	<script type="text/javascript" src="dataviz/plant_map/us-state.js"></script>
	<script type="text/javascript" src="dataviz/plant_map/plant-state.js"></script>
	<script type="text/javascript" src="dataviz/plant_map/plant_info.js"></script>
	<script type="text/javascript" src="dataviz/plant_map/color_clustering.js"></script>
	<script type="text/javascript" src="dataviz/plant_map/plant_map.js"></script>

</head>

<body>
<div class="jumbotron text-center text-white" style="margin-bottom:0">
 	<h1 class="header">SEINet Viz</h1>
 	<p>Hover the images to see the colorful cacti flowers from Arizona!</p> 
</div>

<div class="container" id='jump-here'>
	<div class="accordion-div row">
		<div class="col">
			<!-- Accordion Image Browser -->
			<div class="accordion"></div>
		</div>
	</div>

	<div class="row">
		<!-- div for plant info -->
		<div class="col-sm-4">
		    <div class="card h-300">
		    	<div class="card-body text-center">
			        <h2 class="card-title plant-name"></h2>
			        <div class="scrollable">
			        	<p style="text-align: left; white-space: pre-line; font-size: 12px" class="card-text plant-desc"></p>	
			        </div>
			        <br>
			        <a href="#" class="btn btn-warning plant-link">More info</a>
		        </div>
		    </div>
		 </div>

		<!-- div for map -->
		<div class="col-sm-8" id="mapid"></div>
	</div>
</div>


<!-- D3 script -->
<script>
	// set up the map
	setupMap();

	var jsonFilePath = "dataviz/data/plant_data_new_az_2.json";
	 // d3.keys(data).forEach(function(d){

	function changeData(d){
		
		// console.log(d.info.coordinates_text[0])
		lat_ = parseFloat(d.info.coordinates_text[0][0])
		long_ = parseFloat(d.info.coordinates_text[0][1])
		// ------------------------------   update map here ---------------------------------------------
		console.log(lat_, long_)
		mapZoomTo(lat_, long_);


		d3.select(".plant-name").text(d.name);
		// d3.select(".plant-author").text(d.info.author);
		d3.select(".plant-link").attr("href", d.info.link);
		// d3.select(".plant-desc").text(d.info.desc_field_guide);
		// d3.select(".plant-desc").text(d.info.long_summary);
		d3.select(".plant-desc").text(function (){
			if(d.info.tldr == null){
				if(d.info.tldr_field == null){
					return "No Description Found.";
				}
				else{
					return d.info.tldr_field;
				}
			}
			return d.info.tldr;
		});


		d3.select(".plant-img1").attr("src", d.info.images[0]);
		d3.select(".plant-img2").attr("src", d.info.images[1]);
	}


	var selectedImage = d3.select(null);
	d3.json(jsonFilePath).then(function(data) {
			var bluramt = "1.4"
			var startImage = null;
			var startIdx = null;



		 	var acc = d3.select(".accordion")
					.append("ul")
					.selectAll("li")
					.data(data).enter()
					.append("li")
					.attr("id", function(d, i) { return String(i);})
					.on("click", function(d){
						// Set width of old image to 8%

						if (selectedImage){
							selectedImage.style("filter", "blur("+bluramt+"px)")
							selectedImage.style("width",null);
						}

					    // Set width of clicked image to 150% (150 because image does not stay expanded fully otherwise)
					    selectedImage = d3.select(this);
					    selectedImage.style("width","150%");
					    selectedImage.style("filter", "blur(0px)")
					})
					.style("background-image", function (d) {return "url(" + d.info.image_path + ")";})
					.style("height", 200)
					.style("width", 200)
					.style("filter", "blur("+bluramt+"px)")
					.on("mouseover", handleMouseOver)
					.on("mouseout", handleMouseOut)
					.append("div")
					.append("a")
					.on("click", function(d){
						changeData(d);
					})
					.attr("href", "#jump-here");

			acc.append("h2").text("Lorem Ipsum");
			acc.append("p").text("Lorem ipsum dolor sit amet, consectetur adipiscing elit");

			changeData(data[20]);

			// startImage = d3.select("#20");
		 //    startImage.style("width","150%");
		 //    startImage.style("filter", "blur(0px)");


			// Code to show details of plants
			// d3.select(".accordion").selectAll("li")


			function handleMouseOver(d, i) {  // Add interactivity
				d3.select(this)
				.style("filter", "blur(0px)")
			}

			function handleMouseOut(d, i) {
				thisimg = d3.select(this);
				console.log(thisimg!=selectedImage)

				if (thisimg != selectedImage){
					d3.select(this)
					.style("filter", "blur("+bluramt+"px)")	
				}

				selectedImage.style("filter", "blur(0px)")

			}

		});
		
</script>

</body>


